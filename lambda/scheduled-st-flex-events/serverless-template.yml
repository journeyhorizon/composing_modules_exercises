service: scheduled-st-flex-events

frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs16.x
  stage: ${opt:stage,'test'}

functions:
  stFlexEventHandler:
    handler: handler.fetchStFlexEvents
    events:
      # Invoke Lambda function every minute
      - schedule: rate(1 minute)
    environment:
      EXTERNAL_SERVER_URL:
      INTEGRATION_CLIENT_ID:
      INTEGRATION_CLIENT_SECRET:
  cronPayoutHandler:
    handler: handler.triggerPayout
    events:
      # Invoke Lambda function at 00:00 on 1st and 15th every month
      - schedule: cron(0 0 1,15 * ? *)
    environment:
      EXTERNAL_SERVER_URL:

#Custom ENV declare depends on stage

stageBasedEnv:
  stages:
    - test
    - prod
  externalServerUrl:
    test:
    prod:
  integrationClientId:
    test:
    prod:
  integrationClientSecret:
    test:
    prod:

# Plugins
plugins:
  - serverless-stage-manager
