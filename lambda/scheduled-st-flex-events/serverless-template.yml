service: scheduled-st-flex-events

frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs16.x
  stage: ${opt:stage,'test'}
  profile: life-on-fitness
  region: eu-west-2

functions:
  stFlexEventHandler:
    handler: handler.fetchStFlexEvents
    events:
      # Invoke Lambda function every minute
      - schedule: rate(1 minute)
    environment:
      EXTERNAL_SERVER_URL: ${self:custom.externalServerUrl.${self:provider.stage}}
      INTEGRATION_CLIENT_ID: ${self:custom.integrationClientId.${self:provider.stage}}
      INTEGRATION_CLIENT_SECRET: ${self:custom.integrationClientSecret.${self:provider.stage}}
  cronPayoutHandler:
    handler: handler.triggerPayout
    events:
      # Invoke Lambda function at 00:00 on 1st and 15th every month
      - schedule: cron(0 0 1,15 * ? *)
    environment:
      EXTERNAL_SERVER_URL: ${self:custom.externalServerUrl.${self:provider.stage}}

#Custom ENV declare depends on stage

custom:
  stages:
    - test
    - prod
  externalServerUrl:
    test:
    prod:
  integrationClientId:
    test:
    prod:
  integrationClientSecret:
    test:
    prod:

# Plugins
plugins:
  - serverless-stage-manager
